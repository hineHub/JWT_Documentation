---


---

<h1 id="javascript-web-token-jwt">Javascript Web Token (JWT)</h1>
<p>JWT is a protected data structure\object. It contains server information as well as user claims. It is signed and therefore tamper proof. Contains an expiry time. A user sends creds to issuer which authenticates them and looks at appropriate attributes for the user and sends back a token. This is good as reduces the amount of times creds are supplied boosting performance as you donâ€™t have to keep going to the database to check access.</p>
<p>Not suitable for highly granular roles that will cause performance issues due to the amount of data being sent over the wire.</p>
<h2 id="format">Format</h2>
<p>Simply put JWT is a string in the following format:<br>
<code>Header.Payload.Signature</code></p>
<h3 id="header">Header</h3>
<pre><code>{
"typ": "JWT",
"alg": "HS256"
}
</code></pre>
<p>typ indicates it is a JWT structure. alg indicates which hashing algorithm is being used, uses a secret key known only to the issuer. The header is then base64 encoded for transport.</p>
<h3 id="payloadclaims">Payload\Claims</h3>
<p>The payload contains user information.</p>
<p>Keep in mind that you should keep performance in mind here. The payload is also base64 encoded for transport.</p>
<pre><code>{
    "sub":  "Bill@Home.com",
    "name":  "Frank Spencer",
    "role":  "createAccount, approvePayments"
}
</code></pre>
<h3 id="signature">Signature</h3>
<p>The signature is like a check sum to ensure that no one has tampered with the header or payload.</p>
<pre><code>var  headers  =  base64URLencode(myHeaders);
var  claims  =  base64URLencode(myClaims);
var  payload  =  header  +  "."  +  claims;
var  signature  =  base64URLencode(HMACSHA256(payload,  secret));
var  encodedJWT  =  payload  +  "."  +  signature;
</code></pre>
<h2 id="flow">Flow</h2>
<p><strong>Token request</strong></p>
<div class="mermaid"><svg xmlns="http://www.w3.org/2000/svg" id="mermaid-svg-xP9DSbAkhUIJk5Uh" height="100%" viewBox="0 0 320.5625 126.78125" style="max-width:320.5625px;"><g><g class="output"><g class="clusters"></g><g class="edgePaths"><g class="edgePath" style="opacity: 1;"><path class="path" d="M77.171875,45.5911409719493L128.1015625,31.6953125L179.03125,42.560469002074214" marker-end="url(#arrowhead7774)" style="fill:none"></path><defs><marker id="arrowhead7774" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M179.03125,64.22078099792579L128.1015625,75.0859375L77.171875,61.1901090280507" marker-end="url(#arrowhead7775)" style="fill:none"></path><defs><marker id="arrowhead7775" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g></g><g class="edgeLabels"><g class="edgeLabel" transform="translate(128.1015625,31.6953125)" style="opacity: 1;"><g transform="translate(-25.9296875,-11.6953125)" class="label"><foreignObject width="51.86248779296875" height="23.399999618530273"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">1. Creds</span></div></foreignObject></g></g><g class="edgeLabel" transform="translate(128.1015625,75.0859375)" style="opacity: 1;"><g transform="translate(-22.46875,-11.6953125)" class="label"><foreignObject width="44.9437255859375" height="23.399999618530273"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">2. JWT</span></div></foreignObject></g></g></g><g class="nodes"><g class="node" id="A" transform="translate(48.5859375,53.390625)" style="opacity: 1;"><rect rx="5" ry="5" x="-28.5859375" y="-21.6953125" width="57.171875" height="43.390625"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-18.5859375,-11.6953125)"><foreignObject width="37.1812744140625" height="23.399999618530273"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">Client</div></foreignObject></g></g></g><g class="node" id="B" transform="translate(229.796875,53.390625)" style="opacity: 1;"><rect rx="5" ry="5" x="-50.765625" y="-21.6953125" width="101.53125" height="43.390625"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-40.765625,-11.6953125)"><foreignObject width="81.53436279296875" height="23.399999618530273"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">Issuer Server</div></foreignObject></g></g></g></g></g></g></svg></div>
<p><strong>Subsequent request</strong></p>
<div class="mermaid"><svg xmlns="http://www.w3.org/2000/svg" id="mermaid-svg-0ut5muMfJxBRioBa" height="100%" viewBox="0 0 533.3031311035156 226.85469436645508" style="max-width:533.3031311035156px;"><g><g class="output"><g class="clusters"></g><g class="edgePaths"><g class="edgePath" style="opacity: 1;"><path class="path" d="M70.26390298190616,88.39062690734863L116.921875,41.69531440734863L174.71875,41.69531440734863" marker-end="url(#arrowhead7798)" style="fill:none"></path><defs><marker id="arrowhead7798" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M271.71875,41.69531440734863L314.765625,41.69531440734863L371.1205966083435,79.73096665459596" marker-end="url(#arrowhead7799)" style="fill:none"></path><defs><marker id="arrowhead7799" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M340.26562805175786,110.58594131469728L314.765625,110.08594131469727L223.21875,110.08594131469727L116.921875,110.08594131469727L77.171875,110.08594131469727" marker-end="url(#arrowhead7800)" style="fill:none"></path><defs><marker id="arrowhead7800" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M363.2131226447771,133.5334359077165L314.765625,153.47656631469727L223.21875,153.47656631469727L116.921875,153.47656631469727L77.171875,128.23688413795094" marker-end="url(#arrowhead7801)" style="fill:none"></path><defs><marker id="arrowhead7801" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g></g><g class="edgeLabels"><g class="edgeLabel" transform="translate(116.921875,41.69531440734863)" style="opacity: 1;"><g transform="translate(-14.75,-11.6953125)" class="label"><foreignObject width="29.50311279296875" height="23.399999618530273"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">JWT</span></div></foreignObject></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel" transform="translate(223.21875,110.08594131469727)" style="opacity: 1;"><g transform="translate(-45.953125,-11.6953125)" class="label"><foreignObject width="91.9124755859375" height="23.399999618530273"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">Y - return data</span></div></foreignObject></g></g><g class="edgeLabel" transform="translate(223.21875,153.47656631469727)" style="opacity: 1;"><g transform="translate(-66.546875,-11.6953125)" class="label"><foreignObject width="133.1015625" height="23.399999618530273"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">N - return status 401</span></div></foreignObject></g></g></g><g class="nodes"><g class="node" id="A" transform="translate(48.5859375,110.08594131469727)" style="opacity: 1;"><rect rx="5" ry="5" x="-28.5859375" y="-21.6953125" width="57.171875" height="43.390625"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-18.5859375,-11.6953125)"><foreignObject width="37.1812744140625" height="23.399999618530273"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">Client</div></foreignObject></g></g></g><g class="node" id="B" transform="translate(223.21875,41.69531440734863)" style="opacity: 1;"><rect rx="5" ry="5" x="-48.5" y="-21.6953125" width="97" height="43.390625"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-38.5,-11.6953125)"><foreignObject width="77.0062255859375" height="23.399999618530273"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">Secured API</div></foreignObject></g></g></g><g class="node" id="C" transform="translate(416.5343780517578,110.08594131469727)" style="opacity: 1;"><polygon points="76.76875,0 153.5375,-76.76875 76.76875,-153.5375 0,-76.76875" rx="5" ry="5" transform="translate(-76.76875,76.76875)"></polygon><g class="label" transform="translate(0,0)"><g transform="translate(-64.265625,-11.6953125)"><foreignObject width="128.5452880859375" height="23.399999618530273"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">Valid and authorised</div></foreignObject></g></g></g></g></g></g></svg></div>
<h2 id="storage-locally">Storage (locally)</h2>
<p>You can store the JWT token in a cookie or local session storage.</p>
<h2 id="security-issues-to-be-aware-of">Security Issues to be aware of</h2>
<p><strong>Lazy signature validation</strong><br>
Ensure your validation always assumes their is a signature to verify as some attack vectors will modify the heading to say no signature and remove the signature part before modifying the payload and sending it back to perform some malicious task.</p>
<p><strong>Cross site scripting (XSS)</strong> is a threat where the client does not sanitize input that will later be displayed on the site. This could include scripts that harvest and send information within the token when a user loads a page that has been infected.</p>
<p><strong>Cross site request forgery (CSRF)</strong> unbeknownst to a user they have landed on a site made by the attacker. The site will make a request on the users behalf to the target site. If the user has already logged in and has an active session cookie then the request will be successful unless precautions have been taken.<br>
To prevent, the client would need to have a hidden field that it sends with every request and the server checks for it or to avoid storing JWT in session cookies.</p>

